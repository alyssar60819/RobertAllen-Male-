<!DOCTYPE html>
<html>
<head>
  <title>Getting Started</title>
  <style>
    body {
      background-color: #F1F5F8;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 40px;
      text-align: center;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    h1 {
      color: #225378;
      font-size: 36px;
      margin-bottom: 20px;
    }
    .form-input {
      margin-bottom: 20px;
    }
    .form-input label {
      display: block;
      color: #4F7CAC;
      font-size: 18px;
      margin-bottom: 10px;
    }
    .form-input input[type="text"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #B2DBBF;
      border-radius: 4px;
    }
    .start-button {
      margin-top: 20px;
    }
    .start-button button {
      padding: 12px 24px;
      font-size: 20px;
      background-color: #225378;
      color: #FFFFFF;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Getting Started</h1>
    <div class="form-input">
      <label for="username">Username:</label>
      <input type="text" id="username" name="username" placeholder="Enter your username">
    </div>
    <div class="form-input">
      <label for="book-title">Book Title:</label>
      <input type="text" id="book-title" name="book-title" placeholder="Enter book title">
    </div>
    <div class="form-input">
      <label for="author">Author:</label>
      <input type="text" id="author" name="author" placeholder="Enter author name">
    </div>
    <div class="form-input">
      <label for="current-page">Current Page Number:</label>
      <input type="text" id="current-page" name="current-page" placeholder="Enter current page number">
    </div>
    <div class="start-button">
      <button onclick="startReadingLog()">Start Reading Log</button>
    </div>
  </div>

  <script>
    function startReadingLog() {

      var username = document.getElementById("username").value;
      var bookTitle = document.getElementById("book-title").value;
      var author = document.getElementById("author").value;
      var currentPage = document.getElementById("current-page").value;

      // Check for duplicate username
      fetch('http://localhost:3000/reading-log')
        .then(response => response.json())
        .then(entries => {
          var isDuplicate = entries.some(entry => entry.username.toLowerCase() === username.toLowerCase());

          if (isDuplicate) {
            var confirmMessage = "Are you sure you want to update " + username + "'s reading log?";
            var shouldUpdate = confirm(confirmMessage);

            if (shouldUpdate) {
              // Proceed with updating the reading log
              var data = {
                username: username,
                title: bookTitle,
                author: author,
                pageNumber: currentPage
              };

              fetch('http://localhost:3000/reading-log', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
              })
                .then(response => response.json())
                .then(result => {
                  // Handle the response from the backend if needed
                  console.log(result);
                  // Change the location of the browser to the reading log page
                  window.location.href = 'readingTable.html';
                })
                .catch(error => {
                  console.error('Error:', error);
                });
            } else {
              // Do not proceed with creating/updating the reading log
              return;
            }
          } else {
            // Proceed with creating a new reading log entry
            var data = {
              username: username,
              title: bookTitle,
              author: author,
              pageNumber: currentPage
            };

            fetch('http://localhost:3000/reading-log', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(data)
            })
              .then(response => response.json())
              .then(result => {
                // Handle the response from the backend if needed
                console.log(result);
                // Change the location of the browser to the reading log page
                window.location.href = 'readingTable.html';
              })
              .catch(error => {
                console.error('Error:', error);
              });
          }
        })
        .catch(error => {
          console.error('Error:', error);
        });
    }
  </script>
</body>
</html>
